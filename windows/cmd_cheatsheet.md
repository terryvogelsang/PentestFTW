# Windows - Commands Cheatsheet
## Notes
* Commands with `*` require local administrator privileges
* Commands with `**` require domain administrator privileges

### Default local entities 

#### Users
##### English
```
Administrator
```

##### French
```
Administrateur
```

##### Spanish
```
Administrador
```

#### Groups

##### English
```
```
 
##### Spanish
```
Operadores de asistencia de Control de acceso
Operadores de copia de seguridad
Operadores criptográficos
Administradores de Hyper-V
Operadores de configuración de red
Usuarios avanzados
Usuarios de escritorio remoto
Replicator
```

## Active Directory Domain

### Group Policies
```shell
gpresult /z
```

### Users

#### List all local groups
```shell
net localgroup
```

#### List all domain users
```shell
net user /domain
```

#### Add user to domain 
```shell
net user myUser myPassword /add /domain
```

#### Add user to domain group**
```shell
net group "Domain Admins" myUser /add /domain
```

#### Add  user to local group * 
```shell
net localgroup "remote desktop users" /add
```

#### List all domain controllers (knowing one)
```shell
dig @myDomainControllerIP myDomain.local
```

#### Use BloodHound to gain Domain information

#### Using python ingestor

Ingestor can be found here: https://github.com/fox-it/BloodHound.py

```shell
bloodhound-python -u myUser@myDomain.local -dc myDomainController.local -d myDomain.local -ns myDomainControllerIP -gc myDomainControllerHostname -v
```

#### Extract usernames from Bloodhound
```
cat scans/bloodhound/20220112115503_users.json | jq '.users[].Properties.name' > ./loot/adusers.list
```

## Server / Workstation 

### Computer Configuration

#### Enable Remote Desktop Protocol (RDP) Service*
```shell
net localgroup "Remote Desktop users" myUser /add
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh advfirewall firewall add rule name="Open Port 3389" dir=in action=allow protocol=TCP localport=3389
```

#### Enable / Disable firewall
```shell
netsh firewall set opmode enable
```
```shell
netsh firewall set opmode disable
```

#### Show WLAN interfaces / profiles / networks
This does not work on Windows XP
```shell
netsh wlan show interfaces
```
```shell
netsh wlan show profiles
```
```shell
netsh wlan show networks
```

#### Retrieve WLAN passwords
```shell
netsh wlan show profiles name="mySSID" key=clear
```

#### Check password policy
```shell
net accounts
```

#### Check services information
```shell
sc query
```
```shell
sc queryex type=service state=all
```

#### Start / Stop service
```shell
sc start <SERVICE NAME>
```
```shell
sc stop <SERVICE NAME>
```

#### Kill process by PID
```shell
taskkill f /pid 1337
```

#### Check ARP table
```shell
arp -a
```

#### Check active routes
```shell
netstat -r
```
```shell
route print
```
#### Show network connections by PID
```shell
netstat -nao
```
```shell
netstat -nao | findstr LISTENING
```

#### Get network information
```shell
ipconfig
```

#### Check content of DNS Resolver Cache
```shell
ipconfig /displaydns
```

### Users

#### List all local administrators
```shell
net localgroup administrators
```

#### Get all info from current user
```shell
whoami /all
```

#### Get user privileges from current user
```shell
whoami /priv
```

#### Get groups memberships from current user
```shell
whoami /group
```

#### List all users
```shell
net user
```

#### Add local user
```shell
net user myUser myPassword /add
```

#### Add user to local admin group
```shell
net localgroup administrators myUser /add
```

#### Remove user
```shell
net user myUser /del
```

### Useful information

#### Overall system information
```shell
systeminfo
```

#### List Drives
Good to know about the partition drives in the system so that an attacker can navigate through this and locate sensitive files.  
```shell
fsutil fsinfo drives
```
#### Look for Kernel exploit
```shell
driverquery | findstr Kernel
```

### Interesting files

#### boot.ini
Contains information related to running operating system (basically the options to display when the startup program is running).
```shell
type %SYSTEMDRIVE%\boot.ini
```

#### win.ini
Contains boot time settings, such as fonts, language settings, extensions, wallpaper, screensaver, communication drivers etc. 
```shell
type %WINDIR%\win.ini
```

#### hosts file
Pretty interesting one as it can be used for local system DNS spoofing. 
```shell
type %WINDIR%\System32\drivers\etc\hosts
```

#### List System Logs
```shell
wevtutil el
```
#### Delete Logs
```shell
del \*.log /a /s /q /f
```

#### List Scheduled Tasks
```shell
schtasks /query /fo LIST /v
```

#### List Installed Software
```shell
wmic product get name /value
```

#### Uninstall Software
```shell
wmic product where name="<NAME>" call uninstall /INTERACTIVE:OFF
```

#### Search for Keywords (e.g *pass)
```shell
dir /s *pass* == *key* == *vnc* == *.config*
```
Only in certain files…

```shell
findstr /si pass *.xml *.ini *.txt
```
#### Grep Registrie
```shell
reg query HKLM /f pass /t REG_SZ /s
```
```shell
reg query HKCU /f pass /t REG_SZ /s
```